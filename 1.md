# leetcode sql practice
## 176.second-highest-salary

``` sql
select max(Salary) as SecondHighestSalary  from Employee
    where Salary < (select max(Salary) from Employee)
```
## 181.employees-earning-more-than-their-managers

``` sql
select 
    emp.Name as Employee
    from Employee as emp,Employee as man
        where emp.ManagerId is not null and emp.ManagerId=man.Id and emp.Salary>man.Salary
```

## 182.duplicate-emails

``` sql 
select 
    Email
    from Person 
            group by Email
                 having count(Email)>1
```

## 183.customers-who-never-order

``` sql
select 
    C.Name as Customers
        from Customers as C
            where not exists 
                (select 1 from Orders as O where C.Id=O.CustomerId)
```

## 197.rising-temperature
``` mysql
select b.Id from Weather as a
    cross join Weather as b
        where a.Temperature<b.Temperature and DateDiff(a.RecordDate,b.RecordDate)=-1
```

## 511.game-play-analysis-i
``` mysql
select player_id, min(event_date) as first_login 
from Activity
group by player_id
```

## 512.game-play-analysis-ii
```mysql 
select player_id,device_id
    from Activity where (player_id,event_date) in (
        select player_id,min(event_date) 
            from Activity 
                group by player_id) 
```

## 1068.product-sales-analysis-i
```mysql
select 
    P.product_name,S.year,S.price
    from Product as P,Sales as S
        where P.product_id=S.product_id
```

## 1069.product-sales-analysis-ii
```mysql
select product_id,sum(quantity) as total_quantity 
    from Sales
        group by product_id
```

## 595.big-countries
```mysql
select name,population,area 
    from World
        where population>25000000 or area>3000000 
select name,population,area 
    from World
        where area > 3000000
            union
select name,population,area 
    from World
        where population > 25000000;
```

## 584.find-customer-referee
```mysql
select name 
    from customer 
        where not referee_id = 2 or referee_id is null
```

## 1050.actors-and-directors-who-cooperated-at-least-three-times
```mysql
select actor_id,director_id
    from ActorDirector
            group by actor_id,director_id
                having count(`timestamp`)>=3
```

## 1075.project-employees-i
```mysql
select
    project_id,round(avg(E.experience_years),2) as average_years 
        from Project as P,Employee as E
            where P.employee_id=E.employee_id
                group by project_id
```
## 1075.project-employees-ii
```mysql
select project_id 
        from Project
            group by project_id
    having count(employee_id)=(
        select count(employee_id) AS num FROM project 
        group by project_id  
        order by num desc 
        limit 1
    )
```

## 175.combine-two-tables
```
select 
    P.FirstName, P.LastName, A.City, A.State
        from Person as P 
            left join Address as A
                on P.PersonId=A.PersonId
```

## 596.classes-more-than-5-students
```mysql
select class as Class
    from courses
        group by class 
            having count(distinct student)>=5
```

## 574.winning-candidate
```mysql
select Name from Candidate where id=(
select CandidateId from Vote 
    group by CandidateId
        having count(CandidateId)=(
select  count(CandidateId) as num from Vote
    group by CandidateId  
        order by num desc limit 1))
```

## 627.swap-salary
```mysql
update salary set sex = case sex
        when 'm' then 'f'
        when 'f' then 'm'
    end
```

## 262.
```mysql
select Day,round(count(if( state!='completed',state,null))/sum(num),2) as 'Cancellation Rate'
from(
select Request_at as Day,count(Status) as num ,case Status when 1 then 'completed'
                                                                when 2 then 'cancelled_by_driver'                                                                         when 3 then 'cancelled_by_client'
                                                                end as state
            from Trips
            where DateDiff(Request_at,'2013-10-01')>=0 and DateDiff(Request_at,'2013-10-03')<=0 
and Client_Id in (select Users_Id from Users where Banned='No')
and Driver_Id in (select Users_Id from Users where Banned='No')
            group by Request_at,Status
    ) as a
    group by Day
```

## department-highest-salary
```mysql
select 
    D.Name as Department,
    E.Name as Employee,
    E.Salary 
    from Department as D,Employee as E
        where D.Id=E.DepartmentId
            and  
                (E.Salary,E.DepartmentId) in (
                        select max(Salary),DepartmentId from Employee 
                            group by DepartmentId
                )
```
